<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storya | Upload Story</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="page-glow" aria-hidden="true"></div>

    <header class="hero">
        <p class="eyebrow">Dedicated Composer</p>
        <h1>Upload a New Love Story</h1>
        <p class="hero-copy">Write with clarity, keep it heartfelt, and stay within 500 words.</p>
        <a class="hero-link" href="index.html">Back to Stories</a>
    </header>

    <main class="main-wrap">
        <section class="panel form-panel">
            <div class="panel-head">
                <h2>Publish</h2>
                <p>Readers love concise stories with emotional detail.</p>
            </div>

            <form id="upload-form" class="story-form">
                <label for="title">Title</label>
                <input id="title" type="text" placeholder="The Last Train Promise" required>

                <label for="content">Story</label>
                <textarea id="content" placeholder="Write your story here..." required></textarea>

                <div class="form-meta">
                    <p id="word-count">0 / 500 words</p>
                    <button type="submit">Upload Story</button>
                </div>
            </form>

            <p id="form-status" role="status" aria-live="polite"></p>
        </section>
    </main>

    <footer class="site-footer">
        <p>Storya â€¢ Crafted for heartfelt writing.</p>
    </footer>

    <script>
    const API_URL =
        window.location.hostname === "localhost" && window.location.port === "8080"
            ? "http://localhost:5050/story"
            : "/story";
    const WORD_LIMIT = 500;

    function getWordCount(text) {
        const trimmed = text.trim();
        return trimmed ? trimmed.split(/\s+/).length : 0;
    }

    function updateWordCount() {
        const contentInput = document.getElementById("content");
        const wordCount = document.getElementById("word-count");
        const count = getWordCount(contentInput.value);
        wordCount.textContent = `${count} / ${WORD_LIMIT} words`;
        wordCount.className = count > WORD_LIMIT ? "count-error" : "count-ok";
    }

    async function uploadStory(event) {
        event.preventDefault();

        const titleInput = document.getElementById("title");
        const contentInput = document.getElementById("content");
        const status = document.getElementById("form-status");

        const title = titleInput.value.trim();
        const content = contentInput.value.trim();
        const words = getWordCount(content);

        if (!title || !content) {
            status.textContent = "Please fill in both title and story.";
            status.className = "status-error";
            return;
        }

        if (words > WORD_LIMIT) {
            status.textContent = `Please keep your story within ${WORD_LIMIT} words.`;
            status.className = "status-error";
            return;
        }

        try {
            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, content })
            });

            if (!response.ok) {
                throw new Error("Upload failed");
            }

            titleInput.value = "";
            contentInput.value = "";
            updateWordCount();
            status.textContent = "Story uploaded successfully.";
            status.className = "status-success";
        } catch (_error) {
            status.textContent = "Could not upload right now. Try again.";
            status.className = "status-error";
        }
    }

    document.getElementById("content").addEventListener("input", updateWordCount);
    document.getElementById("upload-form").addEventListener("submit", uploadStory);
    updateWordCount();
    </script>
</body>
</html>
